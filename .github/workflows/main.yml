# ============================================================
# ğŸš€ TESLABTC.KG â€” Despliegue automÃ¡tico a Fly.io (v5.2.0)
# ============================================================

name: Despliegue automÃ¡tico en Fly.io

on:
  # 1ï¸âƒ£ Cada vez que hagas un push a la rama principal
  push:
    branches:
      - main

  # 2ï¸âƒ£ Permite ejecutarlo manualmente desde la pestaÃ±a "Comportamiento"
  workflow_dispatch:

  # 3ï¸âƒ£ Programa una reconstrucciÃ³n automÃ¡tica el dÃ­a 1 de cada mes a las 9 AM UTC
  schedule:
    - cron: '0 9 1 * *'

jobs:
  deploy:
    name: ğŸš€ Desplegar TESLABTC.KG API en Fly.io
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Descarga el cÃ³digo del repositorio
      - name: ğŸ“¦ Descargar cÃ³digo del repositorio
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Instala Flyctl (CLI de Fly.io)
      - name: ğŸ”§ Instalar Flyctl
        uses: superfly/flyctl-actions/setup-flyctl@master

      # 3ï¸âƒ£ Despliega la API en Fly.io usando el token guardado en los secretos
      - name: ğŸš€ Desplegar en Fly.io
        run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
